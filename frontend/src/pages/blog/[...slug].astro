---
import fetchApi from "../../lib/strapi";
import type Article from "../../interfaces/article";
import BlogPost from "../../layouts/BlogPost.astro";

export async function getStaticPaths() {
    const query: Record<string, string> = {
        "populate[0]": "cover.attributes",
        "populate[1]": "categories",
    };

    const posts = await fetchApi<Article[]>({
        endpoint: "articles", // the content type to fetch
        wrappedByKey: "data", // the key to unwrap the response
        query: query,
    });

    return posts.map((post) => ({
        params: { slug: post.attributes.slug },
        props: post,
    }));
}

type Props = Article;

const post = Astro.props;
---

<BlogPost {...post} />
